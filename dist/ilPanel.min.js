/*
	MIT @2016 Ivan Lausuch <ilausuch@gmail.com>

*/
angular.module("il.ui.panel", [])
.directive('ilPanel', function() {
	var controller = ['$scope','$timeout','$attrs', function ($scope,$timeout,$attrs) {
		if ($scope.canDelete==undefined)
			$scope.canDelete=false;
			
		if ($scope.canEdit==undefined)
			$scope.canEdit=false;
			
		if ($scope.canClose==undefined)
			$scope.canClose=false;

		if ($scope.panelStyle==undefined)
			$scope.panelStyle="default"
			
		if ($scope.oldVersion==undefined)
			$scope.oldVersion=true;
		
		if ($scope.headerTitle==undefined && $scope.oldVersion)
			$scope.headerTitle=$scope.title;
			
		$scope.info=function(){
			return {mc:$scope.mc,externalInfo:$scope.externalInfo,buttons:$scope.buttons};
		}
		
		$scope._onEdit=function(){
			$scope.onEdit();
		}
	}];
	
	
	return {
		restrict: 'E',
		scope: {
			headerTitle:"=?",
			title:"=?",
			panelStyle:"=?",
			canDelete:"=?",
			onDelete:"&?",
			canEdit:"=?",
			onEdit:"&?",
			canClose:"=?",
			onClose:"&?",
			buttons:"=?",
			oldVersion:"=?",
			
			mc:"=?",
			externalInfo:"=?"
		},
		controller: controller,
		transclude: true,
		template:'<div class="panel panel-{{panelStyle}}"> <div class="panel-heading" ng-if="headerTitle"> <div style="float:left">{{headerTitle}}</div> <div ng-if="canClose" ng-click="onClose()" style="float:right;cursor:pointer; margin-left: 1em"> <i class="fa fa-close"></i> </div> <div ng-if="canDelete" ng-click="onDelete()" style="float:right;cursor:pointer; margin-left: 1em"> <i class="fa fa-trash"></i> </div> <div ng-if="canEdit" ng-click="onEdit()" style="float:right;cursor:pointer; margin-left: 1em"> <i class="fa fa-pencil"></i> </div> <div ng-repeat="button in buttons" ng-click="button.callback(info())" style="float:right;cursor:pointer; margin-left: 1em" tooltip="{{button.tooltip}}"> <i class="fa fa-{{button.icon}}"></i> </div> <div style="clear:both"></div> </div> <div class="panel-body"> <div style="text-align:right;" ng-if="!headerTitle && (canEdit || canDelete)"> <div ng-if="canClose" ng-click="onClose()" style="float:right;cursor:pointer; margin-left: 1em"> <i class="fa fa-close"></i> </div> <div ng-if="canDelete" ng-click="onDelete()" style="float:right;cursor:pointer;margin-left: 1em"> <i class="fa fa-trash"></i> </div> <div ng-if="canEdit" ng-click="onEdit()" style="float:right;cursor:pointer;margin-left: 1em"> <i class="fa fa-pencil"></i> </div> <div ng-repeat="button in buttons" ng-click="button.callback(info())" style="float:right;cursor:pointer; margin-left: 1em" tooltip="{{button.tooltip}}"> <i class="fa fa-{{button.icon}}"></i> </div> <div style="clear:both"></div> </div> <ng-transclude></ng-transclude> </div></div>'
	}
})
