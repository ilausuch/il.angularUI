/**
LICENSE MIT 2015 ilausuch@gmail.com	
*/

angular.module("il.ui.masterDetail", ['ngSanitize','pascalprecht.translate','ui.bootstrap'])
	.directive('ilMasterDetail', function() {
		var controller = ['$scope','$timeout','$attrs', function ($scope,$timeout,$attrs) {
			$scope.byDefault=function(field,value){
				if ($scope[field]==undefined)
					$scope[field]=value;
			}
			
			$scope.byDefault("eid","ilMasterDetail_"+Math.random());
			$scope.eid_table=$scope.eid+"_table";
			
			if (window.$ilControllers==undefined)
            	window.$ilControllers={}
            	
            window.$ilControllers[$scope.eid]=$scope;
			
			$timeout(function(){
				$scope.columns=window.$ilControllers[$scope.eid_table].columns;	
			})
			
			
			$scope.table={
				onClickItem:function(item,column){
					item.prepareSandbox();
					$scope.modal.model=item;
				}
			}
			
			$scope.input={
				type:function(col){
					switch(col.type){
						case "basic":
							return 'text';
						break;
					}
				}
			}
			
			$scope.modal={
				model:undefined,
				show:function(){
					return this.model!=undefined;
				},
				title:"Edition",
				columnClass:function(){
					return "col-md-6";	
				},
				onSuccess:function(){
					
				}
				
			}
			
		}];
		
		template='<il-table2 eid="eid_table" model="model" class="table table-striped ilTable2" on-click-item="table.onClickItem(item,column)"> <div ng-transclude></div></il-table2><il-modal show="modal.show()" header-title="modal.title" on-succes="modal.onSuccess()"> <div class="row"> <div class="{{modal.columnClass()}}" ng-repeat="col in columns"> <il-input type="input.type(col)" label="col.title" model="modal.model.$sandbox" field="col.field"></il-input> </div> </div></il-modal>';
		
		return {
			restrict: 'E',
			controller: controller,
			template:template,
			transclude: true,
			scope: {
	             model:"=",
	             eid:"=?" 
	              
			}
			
		};
	});