/**
LICENSE MIT 2015 ilausuch@gmail.com	
*/

angular.module("il.ui.advancedCombo", ['ngSanitize','pascalprecht.translate','ui.bootstrap','il.ui.table','il.ui.modal'])
	.directive('ilAdvancedCombo', function() {
		var controller = ['$scope','$timeout','$attrs', function ($scope,$timeout,$attrs) {
			if ($scope.innerShow==undefined)
				$scope.innerShow=true;
				
			if ($scope.placeholder==undefined)
				$scope.placeholder="Select one";
			
			$scope.onSelectItem=function(item){
				$scope.model[$scope.field]=item;
				$scope.show=false;
				if ($scope.onChange!=undefined)
					$scope.onChange({item:item});
			}
			
			$scope.delete=function(){
				$scope.onSelectItem(undefined);
			}
		}];
		
		template='<form class="form-inline" > <div class="form-group" style="width: 100%"> <div class="input-group" style="width: 100%"> <div class="input-group-addon" style="padding: 0px; width: 2.5em" ng-click="show=true" ng-show="innerShow"> <button class="btn" style="padding: 0px 1em 0px 1em" ng-if="!innerLabel"><span class="glyphicon glyphicon-th-list"></span></button> <span ng-if="innerLabel" style="padding: 1em">{{innerLabel}}</span> </div> <input type="text" class="form-control" id="exampleInputAmount" placeholder="{{placeholder|translate}}" readonly="true" ng-model="model[field][labelField]" style="background-color: white; cursor:pointer" ng-click="show=true"> <div class="input-group-addon" style="padding: 0px; width: 2.5em" ng-if="canDelete" ng-click="delete()"> <button class="btn" style="padding: 0px 1em 0px 1em"><span class="glyphicon glyphicon-trash"></span></button> </div> </div> </div></form><il-modal show="show" title="title" footer-visible="false" size="modalSize" top="top||0"> <table il-table search="true" model="list" columns="columns" class="table table-striped" items-per-page="itemsPerPage||5" show-pagination="showPagination" on-click-item="onSelectItem(item)" ></table></il-modal>';
		
		return {
			restrict: 'E',
			scope: {
	              z:'=',
	              title:'=',
	              columns:'=',
	              list:'=',
	              model:'=?',
	              field:'=',
	              innerLabel:"=?",
	              canDelete:"=?",
	              labelField:'=',
	              itemsPerPage:"=",
	              showPagination:"=?",
	              modalSize:'=',
	              top:'=?',
	              onChange:"&",
	              innerShow:"=?",
	              placeholder:"=?"
			},
			controller: controller,
			template:template
		};
	});