/**
LICENSE MIT 2015 ilausuch@gmail.com	
*/

angular.module("il.ui.modal", ['ngSanitize','pascalprecht.translate','ui.bootstrap'])
	.directive('ilModal', function() {
		var controller = ['$scope','$timeout','$attrs', function ($scope,$timeout,$attrs) {
			//Prepare zindex
			if ($scope.z==undefined)
				$scope._zIndex=100;
			else
				$scope._zIndex=$scope.z*100;
			
				
			$scope._zIndexBg=$scope._zIndex-1;
			
			//Prepare functions
			$scope.trueIfUndefined=function(value){
				if (value!=undefined)
					return value;
				else
					return true;
			}
			
			$scope.close=function(success){
				if ($scope.autoClose==undefined||$scope.autoClose)
					$scope.show=false;
				
				if (success){
					if ($scope.onSuccess!=undefined)
						$scope.onSuccess({});
				}else{
					if ($scope.onCancel!=undefined)
						$scope.onCancel({});
				}
			}
		}];
		
		template='<div style="position: fixed; top:0; left:0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.5); z-index: {{_zIndexBg}}" ng-if="show"></div><div style="z-index: {{_zIndex}}; position: fixed; left: 0px; right: 0px;" ng-if="show"> <div style="margin: 0 auto; background-color: white"> <div class="modal" style="display: block"> <div class="modal-dialog" style="width: {{size||\'600px\'}}; top:{{top||\'20px\'}};"> <div class="modal-content"> <div class="modal-header" ng-if="trueIfUndefined(titleVisible)"> <button type="button" class="close" ng-click="close(false)" ng-show="trueIfUndefined(closeVisible)"><span aria-hidden="true">&times;</span></button> <h4 class="modal-title">{{title}}</h4> </div> <div class="modal-body"> <div> <div ng-transclude></div> </div> </div> <div class="modal-footer" ng-if="trueIfUndefined(footerVisible)"> <button type="button" class="btn btn-default" ng-click="close(false)" ng-if="trueIfUndefined(cancelVisible)">{{cancelLabel||\'Cancel\'}}</button> <button type="button" class="btn btn-primary" ng-if="trueIfUndefined(successVisible)" ng-click="close(true)">{{successLabel||\'Save changes\'}}</button> </div> </div><!-- /.modal-content --> </div><!-- /.modal-dialog --> </div><!-- /.modal --> </div></div>';
		
		return {
			restrict: 'E',
			scope: {
	              show: '=?',
	              z:'=',
	              title:'=',
	              
	              cancelVisible:'=',
	              onCancel:'&',
	              cancelLabel:'=',
	              
	              successVisible:'=',
	              onSuccess:'&',
	              successLabel:'=',
	              
	              footerVisible:'=',
	              closeVisible:'=',
	              titleVisible:'=',
	              
	              size:'=',
	              
	              autoClose:'=',
	              
	              top:'=',
	              
			},
			controller: controller,
			template:template,
			transclude: true
		};
	});