/**
LICENSE MIT 2015 ilausuch@gmail.com	
*/

angular.module("il.ui.modal", ['ngSanitize','pascalprecht.translate','ui.bootstrap'])
	.directive('ilModal', function() {
		var controller = ['$scope','$timeout','$attrs', function ($scope,$timeout,$attrs) {
			$scope.byDefault=function(field,value){
				if ($scope[field]==undefined)
					$scope[field]=value;
			}
			
			$scope.byDefault("isLoading",false);
			$scope.byDefault("isMessage",false);
			
			$scope.byDefault("headerTitle", $scope.title);
			
			if ($scope.isLoading){
				//All is false
				$scope.byDefault("titleVisible",false);
				$scope.byDefault("closeVisible",false);
				$scope.byDefault("cancelVisible",false);
				$scope.byDefault("successVisible",false);
				$scope.byDefault("footerVisible",false);
			}
			if ($scope.isMessage){
				$scope.byDefault("titleVisible",false);
				$scope.byDefault("closeVisible",false);
				$scope.byDefault("cancelVisible",false);
				$scope.byDefault("successVisible",false);
				$scope.byDefault("footerVisible",false);
				$scope.byDefault("isInfo",false);
				$scope.byDefault("isAlert",false);
			}
			else{
				$scope.byDefault("titleVisible",true);
				$scope.byDefault("closeVisible",true);
				$scope.byDefault("cancelVisible",true);
				$scope.byDefault("successVisible",true);
				$scope.byDefault("footerVisible",true);
			}
			
			
			//Prepare zindex
			if ($scope.z==undefined)
				$scope._zIndex=100;
			else
				$scope._zIndex=$scope.z;//*100;
			
				
			$scope._zIndexBg=$scope._zIndex-1;
			
			//Prepare functions
			$scope.trueIfUndefined=function(value){
				if (value!=undefined)
					return value;
				else
					return true;
			}
			
			$scope.close=function(success){
				if ($scope.autoClose==undefined||$scope.autoClose)
					$scope.show=false;
				
				if (success){
					if ($scope.onSuccess!=undefined)
						$scope.onSuccess({});
				}else{
					if ($scope.onCancel!=undefined)
						$scope.onCancel({});
				}
			}
			
			$scope.externalClose=function(){
				if ($scope.isMessage)
					$scope.close();
			}
			
			$scope._successDisableFnc=function(){
				if ($scope.successDisabled==undefined)
					return false;
				else
					return $scope.successDisabled;
			}
		}];
		
		template='<div style="position: fixed; top:0; left:0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.5); z-index: {{_zIndexBg}}" ng-if="show"></div><div style="z-index: {{_zIndex}}; position: fixed; left: 0px; right: 0px;" ng-if="show"> <div style="margin: 0 auto; background-color: white"> <div class="modal" style="display: block"> <div class="modal-dialog" style="width: {{size||\'600px\'}}; top:{{top||\'20px\'}};"> <div class="modal-content"> <div class="modal-header" ng-if="titleVisible"> <button type="button" class="close" ng-click="close(false)" ng-show="closeVisible"><span aria-hidden="true">&times;</span></button> <h4 class="modal-title"> <i ng-if="isInfo" class="fa fa-info-circle" style="color:cornflowerblue"></i> <i ng-if="isAlert" class="fa fa-exclamation-circle" style="color:red"></i> <i ng-if="isQuestion" class="fa fa-question-circle" style="color:blue"></i> <i ng-if="isConfirm" class="fa fa-check-circle-o " style="color:#B0FF61"></i> <i ng-if="customIconClass" class="fa {{customIconClass}}" style="color:{{customIconColor}}"></i> {{headerTitle}} </h4> </div> <div class="modal-body"> <div ng-if="isLoading" style="text-align: center"> <p><i class="fa fa-spinner fa-pulse fa-5x"></i></p> <p>{{waitMessage||\'Please wait...\'}}</p> </div> <div ng-if="!isMessage"> <div ng-transclude></div> </div> <div ng-if="isMessage"> <table style="width: 100%"> <tr> <td style="width:4em;"> <i ng-if="isInfo" class="fa fa-info-circle fa-3x" style="color:cornflowerblue"></i> <i ng-if="isAlert" class="fa fa-exclamation-circle fa-3x" style="color:red"></i> <i ng-if="isQuestion" class="fa fa-question-circle fa-3x" style="color:blue"></i> <i ng-if="isConfirm" class="fa fa-check-circle-o fa-3x" style="color:#B0FF61"></i> <i ng-if="customIconClass" class="fa {{customIconClass}} fa-3x" style="color:{{customIconColor}}"></i> </td> <td> <div ng-transclude></div> </td> </tr> </table> <button type="button" class="close" ng-click="close(false)" style="position: absolute; top: 2px; right: 8px;"><span aria-hidden="true">&times;</span></button> </div> </div> <div class="modal-footer" ng-if="footerVisible"> <button type="button" class="btn btn-default" ng-click="close(false)" ng-if="cancelVisible">{{cancelLabel||\'Cancel\'}}</button> <button type="button" class="btn btn-primary" ng-if="successVisible" ng-click="close(true)" ng-disabled="_successDisableFnc()">{{successLabel||\'Save changes\'}}</button> </div> </div><!-- /.modal-content --> </div><!-- /.modal-dialog --> </div><!-- /.modal --> </div></div>';
		
		return {
			restrict: 'E',
			scope: {
	              show: '=?',
	              z:'=',
	              title:'=?',
	              headerTitle:"=?",
	              
	              cancelVisible:'=?',
	              onCancel:'&',
	              cancelLabel:'=',
	              
	              successVisible:'=?',
	              onSuccess:'&',
	              successLabel:'=',
	              successDisabled:'=?',
	              
	              footerVisible:'=?',
	              closeVisible:'=?',
	              titleVisible:'=?',
	              
	              size:'=',
	              
	              autoClose:'=',
	              
	              top:'=',
	              
	              waitMessage:"=?",
	              
	              isLoading:"=?",
	              isMessage:"=?",
	              isInfo:"=?",
	              isAlert:"=?",
	              isQuestion:"=?",
	              isConfirm:"=?",
	              
	              customIconClass:"=?",
	              customIconColor:"=?"
	              
			},
			controller: controller,
			template:template,
			transclude: true
		};
	});